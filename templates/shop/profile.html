<!-- templates/shop/profile.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}My Profile | E-Shop{% endblock %}

{% block extra_css %}
<style>
  .profile-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem 1rem;
  }

  .profile-header {
    text-align: center;
    margin-bottom: 3rem;
  }

  .profile-title {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 0.5rem;
  }

  .profile-subtitle {
    font-size: 1.1rem;
    color: var(--text-light);
  }

  .profile-sidebar {
    background: #f8f9fa;
    border-radius: 12px;
    padding: 2rem;
    height: fit-content;
  }

  .profile-content {
    background: white;
    border-radius: 12px;
    padding: 2rem;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  }

  .nav-pills .nav-link {
    color: var(--text-dark);
    padding: 0.75rem 1rem;
    margin-bottom: 0.5rem;
    border-radius: 8px;
    transition: all 0.3s ease;
  }

  .nav-pills .nav-link.active,
  .nav-pills .nav-link:hover {
    background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
    color: white;
  }

  .stats-card {
    background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
    color: white;
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
  }

  .stats-value {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
  }

  .stats-label {
    font-size: 0.9rem;
    opacity: 0.9;
  }

  .order-card {
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 1.5rem;
    margin-bottom: 1rem;
    transition: transform 0.2s ease;
  }

  .order-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .order-status {
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
  }

  .status-pending { background: #fff3cd; color: #856404; }
  .status-processing { background: #cce7ff; color: #004085; }
  .status-shipped { background: #d1ecf1; color: #0c5460; }
  .status-delivered { background: #d4edda; color: #155724; }
  .status-canceled { background: #f8d7da; color: #721c24; }

  .user-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 2rem;
    font-weight: 700;
    margin: 0 auto 1rem;
  }

  .tab-pane {
    animation: fadeIn 0.5s ease-in-out;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .browse-btn {
    border-radius: 50px;
    padding: 0.5rem 1.5rem;
    font-weight: 500;
  }
</style>
{% endblock %}

{% block content %}
<div class="profile-container">
  <div class="profile-header">
    <h1 class="profile-title">My Account</h1>
    <p class="profile-subtitle">
      Manage your profile and view your order history
    </p>
  </div>

  <div class="row">
    <!-- Left Navigation Sidebar -->
    <div class="col-lg-3 mb-4">
      <div class="profile-sidebar">
        <div class="user-avatar">
          {{ user.username|first|upper }}
        </div>
        <h5 class="text-center mb-3">{{ user.get_full_name|default:user.username }}</h5>
        
        <nav class="nav nav-pills flex-column">
          <a class="nav-link {% if not order_history_active %}active{% endif %}" 
             href="#profile" data-bs-toggle="tab">
            <i class="bi bi-person me-2"></i>Profile Overview
          </a>
          <a class="nav-link {% if order_history_active %}active{% endif %}" 
             href="#orders" data-bs-toggle="tab">
            <i class="bi bi-bag me-2"></i>Order History
          </a>
          <a class="nav-link" href="{% url 'logout' %}">
            <i class="bi bi-box-arrow-right me-2"></i>Logout
          </a>
        </nav>
      </div>
    </div>

    <!-- Right Content Area -->
    <div class="col-lg-9">
      <div class="profile-content">
        <div class="tab-content">
          <!-- Profile Overview Tab -->
          <div class="tab-pane fade {% if not order_history_active %}show active{% endif %}" id="profile">
            <h4 class="mb-4">Profile Overview</h4>
            
            <div class="row mb-4">
              <div class="col-md-6">
                <div class="stats-card">
                  <div class="stats-value">{{ completed_orders.count }}</div>
                  <div class="stats-label">Completed Orders</div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="stats-card" style="background: linear-gradient(135deg, #ff416c, #ff4b2b);">
                  <div class="stats-value">৳{{ total_spent|floatformat:2 }}</div>
                  <div class="stats-label">Total Spent</div>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6">
                <div class="card">
                  <div class="card-body">
                    <h5 class="card-title">Personal Information</h5>
                    <p><strong>Username:</strong> {{ user.username }}</p>
                    <p><strong>Email:</strong> {{ user.email }}</p>
                    <p><strong>Joined:</strong> {{ user.date_joined|date:"F j, Y" }}</p>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="card">
                  <div class="card-body">
                    <h5 class="card-title">Quick Actions</h5>
                    <div class="d-grid gap-2">
                      <a href="{% url 'product_list' %}" class="btn btn-primary browse-btn">
                        Continue Shopping
                      </a>
                      <a href="{% url 'cart_detail' %}" class="btn btn-outline-primary">
                        View Cart
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Order History Tab -->
          <div class="tab-pane fade {% if order_history_active %}show active{% endif %}" id="orders">
            <h4 class="mb-4">Order History</h4>
            
            {% if orders %}
              {% for order in orders %}
              <div class="order-card">
                <div class="row align-items-center">
                  <div class="col-md-4">
                    <h6>Order #{{ order.id }}</h6>
                    <small class="text-muted">{{ order.created_at|date:"F j, Y g:i A" }}</small>
                  </div>
                  <div class="col-md-3">
                    <span class="order-status status-{{ order.status }}">
                      {{ order.get_status_display }}
                    </span>
                  </div>
                  <div class="col-md-3">
                    <strong>৳{{ order.get_total_cost|floatformat:2 }}</strong>
                  </div>
                  <div class="col-md-2 text-end">
                    <a href="" class="btn btn-sm btn-outline-primary">View Details</a>
                  </div>
                </div>
              </div>
              {% endfor %}
            {% else %}
              <div class="text-center py-5">
                <i class="bi bi-bag-x" style="font-size: 3rem; color: #6c757d;"></i>
                <h5 class="mt-3">No orders yet</h5>
                <p class="text-muted">You haven't placed any orders yet.</p>
                <a href="{% url 'product_list' %}" class="btn btn-primary browse-btn">
                  Start Shopping
                </a>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  // Activate tabs based on URL parameters
  document.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    const tab = urlParams.get('tab');
    
    if (tab === 'orders') {
      const ordersTab = new bootstrap.Tab(document.querySelector('a[href="#orders"]'));
      ordersTab.show();
    }
  });
</script>
{% endblock %}